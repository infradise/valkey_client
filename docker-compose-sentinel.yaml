#
# Copyright 2025-2026 Infradise Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
services:
  # Master Node
  sentinel-master-7201: &sentinel_node
    image: ${CI_IMAGE_NAME}
    ports: ["7201:7201", "17201:17201"]
    volumes:
      - ${ABS_CERT_PATH}:/tls:ro
    command: >
      ${CI_BINARY_NAME}-server
      --port 7201
      --protected-mode no
    container_name: "${COMPOSE_PROJECT_NAME}_7201"

  # Replica 1
  sentinel-replica-7202:
    <<: *sentinel_node
    ports: ["7202:7202", "17202:17202"]
    command: >
      ${CI_BINARY_NAME}-server
      --port 7202
      --replicaof sentinel-master-7201 7201
      --protected-mode no
      --replica-announce-ip 127.0.0.1
      --replica-announce-port 7202
    container_name: "${COMPOSE_PROJECT_NAME}_7202"
    depends_on:
      - sentinel-master-7201

  # Replica 2
  sentinel-replica-7203:
    <<: *sentinel_node
    ports: ["7203:7203", "17203:17203"]
    command: >
      ${CI_BINARY_NAME}-server
      --port 7203
      --replicaof sentinel-master-7201 7201
      --protected-mode no
      --replica-announce-ip 127.0.0.1
      --replica-announce-port 7203
    container_name: "${COMPOSE_PROJECT_NAME}_7203"
    depends_on:
      - sentinel-master-7201
